{% import "macros.html" as macros %}
{% extends "index.html" %}

{% block content %}

{% set data = load_data(path="static/references.bib", format="bibtex") -%}
{% set sorted_bib = data.bibliographies %}

<div>
    {% set_global last_year = "" %}
    {%- for bib in sorted_bib | sort(attribute="tags.year") | reverse %}
    {%- if last_year != bib.tags.year %}
        <h1 class="pub-year">{{bib.tags.year}}</h1>
        {%- set_global last_year = bib.tags.year -%}
    {% endif -%}

    <div class="publication">
        {% set _title = macros::process_bib(text=bib.tags.title) %}
        <h2>
            {% if bib.tags.doi %}
            <a href="http://dx.doi.org/{{bib.tags.doi}}" class="pub-link">
                {{_title}}
            </a>
            {% else %}
            {{_title}}
            {% endif %}
        </h2>
        <p>
            {{ bib.tags.author }}.
            {% if bib.tags.booktitle %}
            <span class="pub-journal">{{macros::process_bib(text=bib.tags.booktitle)}}.</span>
            {% endif %}
            {% if bib.tags.journal %}
            <span class="pub-journal">{{macros::process_bib(text=bib.tags.journal)}}.</span>
            {% endif %}
        </p>
    </div>
    {% endfor -%}
</div>

{% endblock content %}
